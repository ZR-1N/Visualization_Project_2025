<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Explorer: è®¡ç®—æœºè§†è§‰æ¼”åŒ–å›¾è°±</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* --- 1. åŸºç¡€å¸ƒå±€è®¾è®¡ --- */
        body {
            background-color: #050505; /* æé»‘èƒŒæ™¯ */
            color: #e0e0e0;
            margin: 0;
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* é˜²æ­¢æ»šåŠ¨ */
            display: flex;
            height: 100vh;
        }

        /* å·¦ä¾§æ§åˆ¶é¢æ¿ */
        #sidebar {
            width: 300px;
            background: rgba(20, 20, 25, 0.95);
            border-right: 1px solid #333;
            padding: 20px;
            display: flex;
            flex-direction: column;
            z-index: 10;
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
        }

        /* ä¸»ç”»å¸ƒåŒºåŸŸ */
        #main-view {
            flex-grow: 1;
            position: relative;
            background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%); /* æ˜Ÿç©ºèƒŒæ™¯ */
        }

        /* --- 2. UI ç»„ä»¶æ ·å¼ --- */
        h1 { font-size: 20px; color: #fff; margin-top: 0; letter-spacing: 1px; }
        h2 { font-size: 14px; color: #888; margin-bottom: 20px; font-weight: 300; }
        
        .control-group { margin-bottom: 30px; }
        label { display: block; font-size: 12px; color: #aaa; margin-bottom: 8px; font-weight: 600; }

        /* æœç´¢æ¡† */
        #search-box {
            width: 100%;
            padding: 10px;
            background: #2a2a35;
            border: 1px solid #444;
            color: #fff;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box; /* é˜²æ­¢paddingæ’‘ç ´å®½åº¦ */
            transition: border-color 0.3s;
        }
        #search-box:focus { outline: none; border-color: #ff9f1c; }

        /* å¹´ä»½æ»‘å—å®¹å™¨ */
        .slider-container { display: flex; align-items: center; gap: 10px; }
        #year-slider { flex-grow: 1; cursor: pointer; }
        #year-display { font-size: 16px; font-weight: bold; color: #ff9f1c; width: 40px; text-align: right;}

        /* å›¾ä¾‹æ¡ */
        .legend-bar {
            height: 10px;
            width: 100%;
            background: linear-gradient(to right, #000004, #57106e, #bc3754, #f98e09, #fcffa4);
            border-radius: 5px;
            margin-top: 5px;
        }
        .legend-labels { display: flex; justify-content: space-between; font-size: 10px; color: #666; margin-top: 3px; }

        /* è¯¦æƒ…é¢æ¿ (é»˜è®¤éšè—å†…å®¹) */
        #info-panel {
            margin-top: auto; /* æ¨åˆ°åº•éƒ¨ */
            padding-top: 20px;
            border-top: 1px solid #333;
        }
        .info-title { font-size: 16px; font-weight: 600; color: #fff; margin-bottom: 5px; line-height: 1.4;}
        .info-meta { font-size: 12px; color: #ff9f1c; margin-bottom: 10px; }
        .info-desc { font-size: 13px; color: #ccc; line-height: 1.5; max-height: 200px; overflow-y: auto; }
        .tag { display: inline-block; padding: 2px 6px; background: #333; border-radius: 4px; font-size: 10px; margin-right: 4px; margin-top: 5px; color: #aaa;}

        /* --- 3. D3 å›¾è¡¨æ ·å¼ --- */
        #chart { width: 100%; height: 100%; }
        
        /* ç‚¹çš„æ ·å¼ */
        .dot { 
            cursor: pointer; 
            transition: opacity 0.3s ease; /* å¹³æ»‘è¿‡æ¸¡ */
        }
        /* æœç´¢æ—¶ä¸ç›¸å…³çš„ç‚¹å˜æš— */
        .dimmed { opacity: 0.05 !important; }
        /* é€‰ä¸­çš„ç‚¹é«˜äº® */
        .highlight { stroke: #fff; stroke-width: 2px; opacity: 1 !important; r: 6px !important; }

        /* Tooltip */
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(4px);
            padding: 8px 12px;
            border-radius: 4px;
            pointer-events: none;
            display: none;
            border: 1px solid #555;
            font-size: 12px;
            color: #fff;
            z-index: 100;
            max-width: 250px;
        }
    </style>
</head>
<body>

    <div id="sidebar">
        <h1>ğŸŒŒ CV Explorer</h1>
        <h2>20,000+ ç¯‡é¡¶ä¼šè®ºæ–‡è¯­ä¹‰å›¾è°±</h2>

        <div class="control-group">
            <label>ğŸ” å…³é”®è¯æœç´¢ (Search Topics)</label>
            <input type="text" id="search-box" placeholder="è¾“å…¥ e.g. GAN, Transformer, NeRF...">
        </div>

        <div class="control-group">
            <label>â³ æ—¶é—´æ—…è¡Œ (Time Travel)</label>
            <div class="slider-container">
                <span style="font-size:12px; color:#666">2015</span>
                <input type="range" id="year-slider" min="2015" max="2024" value="2024" step="1">
                <span id="year-display">ALL</span>
            </div>
            <div style="font-size: 10px; color: #555; margin-top: 5px;">* æ‹–åŠ¨æŸ¥çœ‹å†å¹´æ¼”å˜ï¼Œæœ€å³ä¸ºæ˜¾ç¤ºå…¨éƒ¨</div>
        </div>

        <div class="control-group">
            <label>ğŸ¨ å¹´ä»½åˆ†å¸ƒ (Color by Year)</label>
            <div class="legend-bar"></div>
            <div class="legend-labels">
                <span>2015 (Dark)</span>
                <span>2020</span>
                <span>2024 (Bright)</span>
            </div>
        </div>

        <div id="info-panel">
            <div style="color: #555; font-style: italic; text-align: center; margin-top: 20px;">
                ç‚¹å‡»å›¾ä¸­çš„ç‚¹<br>æŸ¥çœ‹è®ºæ–‡è¯¦æƒ…
            </div>
        </div>
    </div>

    <div id="main-view">
        <div id="tooltip"></div>
        <div id="chart"></div>
    </div>

    <script>
        // --- å…¨å±€å˜é‡ ---
        let allData = [];
        let width, height;
        const margin = 20;

        // è®¾ç½®ç”»å¸ƒ
        const chartContainer = document.getElementById("chart");
        width = chartContainer.clientWidth;
        height = chartContainer.clientHeight;

        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("viewBox", [0, 0, width, height])
            .style("cursor", "grab"); // æŠ“æ‰‹å›¾æ ‡

        // ç¼©æ”¾å±‚ (G)
        const g = svg.append("g");

        // ç¼©æ”¾è¡Œä¸º
        const zoom = d3.zoom()
            .scaleExtent([0.5, 20]) // ç¼©æ”¾èŒƒå›´
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });
        svg.call(zoom);

        // é¢œè‰²æ¯”ä¾‹å°º (Magma: æ·±é»‘ç´« -> äº®é»„)
        // è¿™ç§é…è‰²åœ¨æ·±è‰²èƒŒæ™¯ä¸‹çœ‹èµ·æ¥éå¸¸æœ‰ç§‘æŠ€æ„Ÿä¸”ç¬¦åˆæ—¶é—´é€»è¾‘
        const colorScale = d3.scaleSequential(d3.interpolateMagma)
            .domain([2014, 2025]); // ç¨å¾®æ”¾å®½ä¸€ç‚¹èŒƒå›´ï¼Œè®©2015ä¸è¦å¤ªé»‘ï¼Œ2024ä¸è¦å¤ªç™½

        // --- åŠ è½½æ•°æ® ---
        d3.json("./data/final_data.json").then(function (data) {
            allData = data.scatter;
            console.log(`Loaded ${allData.length} papers.`);

            // åæ ‡æ˜ å°„
            const xExtent = d3.extent(allData, d => d.x);
            const yExtent = d3.extent(allData, d => d.y);

            const xScale = d3.scaleLinear()
                .domain(xExtent)
                .range([margin, width - margin]);

            const yScale = d3.scaleLinear()
                .domain(yExtent)
                .range([height - margin, margin]);

            // --- æ¸²æŸ“ç‚¹ ---
            // ä¸ºäº†æ€§èƒ½ï¼Œæˆ‘ä»¬ä¸ç»‘å®šå¤æ‚æ•°æ®åˆ°DOMï¼Œåªç»‘å®šç´¢å¼•æˆ–è½»é‡å¯¹è±¡
            const circles = g.selectAll("circle")
                .data(allData)
                .enter()
                .append("circle")
                .attr("class", "dot")
                .attr("cx", d => xScale(d.x))
                .attr("cy", d => yScale(d.y))
                .attr("r", 1.8) // é»˜è®¤åŠå¾„
                .attr("fill", d => colorScale(d.year))
                .attr("opacity", 0.8);

            // --- äº¤äº’é€»è¾‘ ---

            // 1. Hover æç¤ºæ¡†
            circles.on("mouseover", function(event, d) {
                d3.select("#tooltip")
                    .style("display", "block")
                    .style("left", (event.pageX + 15) + "px")
                    .style("top", (event.pageY + 15) + "px")
                    .html(`
                        <div style="color:${colorScale(d.year)}">â— ${d.year} ${d.conf}</div>
                        <strong>${d.title}</strong>
                    `);
                
                // é¼ æ ‡ç»è¿‡æ—¶ç¨å¾®å˜å¤§
                d3.select(this).attr("r", 4).attr("opacity", 1);
            })
            .on("mouseout", function() {
                d3.select("#tooltip").style("display", "none");
                // æ¢å¤åŸçŠ¶ (éœ€è¦åˆ¤æ–­æ˜¯å¦è¢«æœç´¢é«˜äº®)
                const isDimmed = d3.select(this).classed("dimmed");
                if (!isDimmed) {
                    d3.select(this).attr("r", 1.8).attr("opacity", 0.8);
                }
            });

            // 2. ç‚¹å‡»æ˜¾ç¤ºè¯¦æƒ… (Side Panel)
            circles.on("click", function(event, d) {
                // é˜»æ­¢äº‹ä»¶å†’æ³¡
                event.stopPropagation();

                // é«˜äº®é€‰ä¸­ç‚¹
                d3.selectAll(".dot").classed("highlight", false).attr("r", 1.8);
                d3.select(this).classed("highlight", true).attr("r", 8).raise(); // raiseæŠŠç‚¹æåˆ°æœ€ä¸Šå±‚

                // æ›´æ–°ä¾§è¾¹æ 
                const kwsHtml = d.kws.map(k => `<span class="tag">${k}</span>`).join("");
                const panel = d3.select("#info-panel");
                panel.html(`
                    <div class="info-meta" style="color:${colorScale(d.year)}">
                        ${d.year} | ${d.conf}
                    </div>
                    <div class="info-title">${d.title}</div>
                    <div style="font-size:12px; color:#888; margin-bottom:10px;">
                        Authors: ${d.authors ? d.authors.slice(0, 100) + "..." : "Unknown"}
                    </div>
                    <div>${kwsHtml}</div>
                    <hr style="border-color:#333; margin:15px 0;">
                    <div class="info-desc">
                        (Semantic Coordinate: ${d.x.toFixed(1)}, ${d.y.toFixed(1)})<br>
                        This paper is clustered based on its abstract content.
                    </div>
                `);
            });

            // ç‚¹å‡»ç©ºç™½å¤„å–æ¶ˆé«˜äº®
            svg.on("click", () => {
                d3.selectAll(".dot").classed("highlight", false).attr("r", 1.8);
                d3.select("#info-panel").html(`
                    <div style="color: #555; font-style: italic; text-align: center; margin-top: 20px;">
                        ç‚¹å‡»å›¾ä¸­çš„ç‚¹<br>æŸ¥çœ‹è®ºæ–‡è¯¦æƒ…
                    </div>
                `);
            });

            // --- æ§åˆ¶å™¨é€»è¾‘ ---

            // A. æœç´¢åŠŸèƒ½
            const searchBox = document.getElementById("search-box");
            searchBox.addEventListener("input", (e) => {
                const term = e.target.value.toLowerCase();
                
                if (term.length < 2) {
                    // æœç´¢è¯å¤ªçŸ­ï¼Œæ¢å¤åŸæ ·
                    circles.classed("dimmed", false).attr("r", 1.8);
                    return;
                }

                circles.each(function(d) {
                    // åŒ¹é…æ ‡é¢˜æˆ–å…³é”®è¯
                    const match = d.title.toLowerCase().includes(term) || 
                                  d.kws.some(k => k.includes(term));
                    
                    const el = d3.select(this);
                    if (match) {
                        el.classed("dimmed", false)
                          .attr("r", 4)     // åŒ¹é…ç‚¹å˜å¤§
                          .attr("opacity", 1)
                          .raise();         // æåˆ°æœ€å‰
                    } else {
                        el.classed("dimmed", true)
                          .attr("r", 1.0);  // ä¸åŒ¹é…ç‚¹å˜å°
                    }
                });
            });

            // B. å¹´ä»½æ»‘å—
            const slider = document.getElementById("year-slider");
            const yearDisplay = document.getElementById("year-display");
            
            slider.addEventListener("input", (e) => {
                const year = parseInt(e.target.value);
                
                if (year === 2024) {
                    // è®¾ä¸º2024æ—¶æ˜¾ç¤ºå…¨éƒ¨ (ä½œä¸ºæ¼”ç¤ºé€»è¾‘)
                    yearDisplay.textContent = "ALL";
                    circles.style("display", "block");
                } else {
                    yearDisplay.textContent = year;
                    // åªæ˜¾ç¤º <= å½“å‰å¹´ä»½çš„è®ºæ–‡ï¼Œæˆ–è€…åªæ˜¾ç¤ºå½“å¹´çš„
                    // è¿™é‡Œæˆ‘ä»¬åš "ç´¯ç§¯æ¨¡å¼"ï¼šæ˜¾ç¤ºåˆ°è¯¥å¹´ä»½ä¸ºæ­¢çš„æ‰€æœ‰è®ºæ–‡
                    circles.style("display", d => d.year <= year ? "block" : "none");
                }
            });

        }).catch(err => {
            console.error(err);
            d3.select("#chart").html("<h3 style='color:red; text-align:center; margin-top:50px'>æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ Live Server</h3>");
        });

        // çª—å£å¤§å°è°ƒæ•´é€‚é…
        window.addEventListener("resize", () => {
            const w = chartContainer.clientWidth;
            const h = chartContainer.clientHeight;
            svg.attr("viewBox", [0, 0, w, h]);
        });

    </script>
</body>
</html>